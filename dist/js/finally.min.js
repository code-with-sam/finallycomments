// EMBED INCLUDE
!function(W){"use strict";function X(Na,Oa,Pa){"addEventListener"in window?Na.addEventListener(Oa,Pa,!1):"attachEvent"in window&&Na.attachEvent("on"+Oa,Pa)}function Y(Na,Oa,Pa){"removeEventListener"in window?Na.removeEventListener(Oa,Pa,!1):"detachEvent"in window&&Na.detachEvent("on"+Oa,Pa)}function Z(){var Na,Oa=["moz","webkit","o","ms"];for(Na=0;Na<Oa.length&&!Ha;Na+=1)Ha=window[Oa[Na]+"RequestAnimationFrame"];Ha||ba("setup","RequestAnimationFrame not supported")}function $(Na){var Oa="Host page: "+Na;return window.top!==window.self&&(Oa=window.parentIFrame&&window.parentIFrame.getId?window.parentIFrame.getId()+": "+Na:"Nested host page: "+Na),Oa}function _(Na){return Ea+"["+$(Na)+"]"}function aa(Na){return Ja[Na]?Ja[Na].log:Aa}function ba(Na,Oa){ea("log",Na,Oa,aa(Na))}function ca(Na,Oa){ea("info",Na,Oa,aa(Na))}function da(Na,Oa){ea("warn",Na,Oa,!0)}function ea(Na,Oa,Pa,Qa){!0===Qa&&"object"==typeof window.console&&console[Na](_(Oa),Pa)}function fa(Na){function Oa(){Qa("Height"),Qa("Width"),na(function(){ma(jb),ja(kb),db("resizedCallback",jb)},jb,"init")}function Qa(lb){var mb=+Ja[kb]["max"+lb],nb=+Ja[kb]["min"+lb],ob=lb.toLowerCase(),pb=+jb[ob];ba(kb,"Checking "+ob+" is in range "+nb+"-"+mb),nb>pb&&(pb=nb,ba(kb,"Set "+ob+" to min value")),pb>mb&&(pb=mb,ba(kb,"Set "+ob+" to max value")),jb[ob]=""+pb}function Ua(lb){return ib.substr(ib.indexOf(":")+Da+lb)}function Va(lb){ba(kb,"MessageCallback passed: {iframe: "+jb.iframe.id+", message: "+lb+"}"),db("messageCallback",{iframe:jb.iframe,message:JSON.parse(lb)}),ba(kb,"--")}function Wa(){var lb=document.body.getBoundingClientRect(),mb=jb.iframe.getBoundingClientRect();return JSON.stringify({iframeHeight:mb.height,iframeWidth:mb.width,clientHeight:Math.max(document.documentElement.clientHeight,window.innerHeight||0),clientWidth:Math.max(document.documentElement.clientWidth,window.innerWidth||0),offsetTop:parseInt(mb.top-lb.top,10),offsetLeft:parseInt(mb.left-lb.left,10),scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset})}function Xa(lb,mb){ra(function(){oa("Send Page Info","pageInfo:"+Wa(),lb,mb)},32)}function Ya(){function lb(pb,qb){function rb(){Ja[ob]?Xa(Ja[ob].iframe,ob):mb()}["scroll","resize"].forEach(function(sb){ba(ob,pb+sb+" listener for sendPageInfo"),qb(window,sb,rb)})}function mb(){lb("Remove ",Y)}var ob=kb;(function(){lb("Add ",X)})(),Ja[ob]&&(Ja[ob].stopPageInfo=mb)}function Za(){Ja[kb]&&Ja[kb].stopPageInfo&&(Ja[kb].stopPageInfo(),delete Ja[kb].stopPageInfo)}function _a(lb){var mb=lb.getBoundingClientRect();return ia(kb),{x:Math.floor(+mb.left+ +Ga.x),y:Math.floor(+mb.top+ +Ga.y)}}function ab(lb){var pb=lb?_a(jb.iframe):{x:0,y:0},qb=function(){return{x:+jb.width+pb.x,y:+jb.height+pb.y}}();ba(kb,"Reposition requested from iFrame (offset x:"+pb.x+" y:"+pb.y+")"),window.top===window.self?function(){Ga=qb,bb(),ba(kb,"--")}():function(){window.parentIFrame?window.parentIFrame["scrollTo"+(lb?"Offset":"")](qb.x,qb.y):da(kb,"Unable to scroll to requested position, window.parentIFrame not found")}()}function bb(){!1===db("scrollCallback",Ga)?ka():ja(kb)}function cb(lb){var ob=lb.split("#")[1]||"",pb=decodeURIComponent(ob),qb=document.getElementById(pb)||document.getElementsByName(pb)[0];qb?function(){var rb=_a(qb);ba(kb,"Moving to in page link (#"+ob+") at x: "+rb.x+" y: "+rb.y),Ga={x:rb.x,y:rb.y},bb(),ba(kb,"--")}():window.top===window.self?ba(kb,"In page link #"+ob+" not found"):function(){window.parentIFrame?window.parentIFrame.moveToAnchor(ob):ba(kb,"In page link #"+ob+" not found and window.parentIFrame not found")}()}function db(lb,mb){return ga(kb,lb,mb)}function hb(){Ja[kb]&&(Ja[kb].firstRun=!1)}var ib=Na.data,jb={},kb=null;"[iFrameResizerChild]Ready"===ib?function(){for(var lb in Ja)oa("iFrame requested init",pa(lb),document.getElementById(lb),lb)}():function(){return Ea===(""+ib).substr(0,Fa)&&ib.substr(Fa).split(":")[0]in Ja}()?(jb=function(){var lb=ib.substr(Fa).split(":");return{iframe:Ja[lb[0]]&&Ja[lb[0]].iframe,id:lb[0],height:lb[1],width:lb[2],type:lb[3]}}(),kb=La=jb.id,Ja[kb]&&(Ja[kb].loaded=!0),!function(){var lb=jb.type in{"true":1,"false":1,undefined:1};return lb&&ba(kb,"Ignoring init message from meta parent page"),lb}()&&function(lb){var mb=!0;return Ja[lb]||(mb=!1,da(jb.type+" No settings for "+lb+". Message was: "+ib)),mb}(kb)&&(ba(kb,"Received: "+ib),function(){var lb=!0;return null===jb.iframe&&(da(kb,"IFrame ("+jb.id+") not found"),lb=!1),lb}()&&function(){var mb=Na.origin,nb=Ja[kb]&&Ja[kb].checkOrigin;if(nb&&"null"!=""+mb&&!function(){return nb.constructor===Array?function(){var qb=0,rb=!1;for(ba(kb,"Checking connection is from allowed list of origins: "+nb);qb<nb.length;qb++)if(nb[qb]===mb){rb=!0;break}return rb}():function(){var qb=Ja[kb]&&Ja[kb].remoteHost;return ba(kb,"Checking connection is from: "+qb),mb===qb}()}())throw new Error("Unexpected message received from: "+mb+" for "+jb.iframe.id+". Message was: "+Na.data+". This error can be disabled by setting the checkOrigin: false option or by providing of array of trusted domains.");return!0}()&&function(){switch(Ja[kb]&&Ja[kb].firstRun&&hb(),jb.type){case"close":Ja[kb].closeRequestCallback?ga(kb,"closeRequestCallback",Ja[kb].iframe):ha(jb.iframe);break;case"message":Va(Ua(6));break;case"scrollTo":ab(!1);break;case"scrollToOffset":ab(!0);break;case"pageInfo":Xa(Ja[kb]&&Ja[kb].iframe,kb),Ya();break;case"pageInfoStop":Za();break;case"inPageLink":cb(Ua(9));break;case"reset":la(jb);break;case"init":Oa(),db("initCallback",jb.iframe);break;default:Oa();}}())):ca(kb,"Ignored: "+ib)}function ga(Na,Oa,Pa){var Qa=null,Ra=null;if(Ja[Na]){if(Qa=Ja[Na][Oa],"function"!=typeof Qa)throw new TypeError(Oa+" on iFrame["+Na+"] is not a function");Ra=Qa(Pa)}return Ra}function ha(Na){var Oa=Na.id;ba(Oa,"Removing iFrame: "+Oa),Na.parentNode&&Na.parentNode.removeChild(Na),ga(Oa,"closedCallback",Oa),ba(Oa,"--"),delete Ja[Oa]}function ia(Na){null===Ga&&(Ga={x:window.pageXOffset===W?document.documentElement.scrollLeft:window.pageXOffset,y:window.pageYOffset===W?document.documentElement.scrollTop:window.pageYOffset},ba(Na,"Get page position: "+Ga.x+","+Ga.y))}function ja(Na){null!==Ga&&(window.scrollTo(Ga.x,Ga.y),ba(Na,"Set page position: "+Ga.x+","+Ga.y),ka())}function ka(){Ga=null}function la(Na){ba(Na.id,"Size reset requested by "+("init"===Na.type?"host page":"iFrame")),ia(Na.id),na(function(){ma(Na),oa("reset","reset",Na.iframe,Na.id)},Na,"reset")}function ma(Na){function Oa(Sa){Na.iframe.style[Sa]=Na[Sa]+"px",ba(Na.id,"IFrame ("+Ra+") "+Sa+" set to "+Na[Sa]+"px")}function Pa(Sa){Ba||"0"!==Na[Sa]||(Ba=!0,ba(Ra,"Hidden iFrame detected, creating visibility listener"),sa())}function Qa(Sa){Oa(Sa),Pa(Sa)}var Ra=Na.iframe.id;Ja[Ra]&&(Ja[Ra].sizeHeight&&Qa("height"),Ja[Ra].sizeWidth&&Qa("width"))}function na(Na,Oa,Pa){Pa!==Oa.type&&Ha?(ba(Oa.id,"Requesting animation frame"),Ha(Na)):Na()}function oa(Na,Oa,Pa,Qa,Ra){function Sa(){var Xa=Ja[Qa]&&Ja[Qa].targetOrigin;ba(Qa,"["+Na+"] Sending msg to iframe["+Qa+"] ("+Oa+") targetOrigin: "+Xa),Pa.contentWindow.postMessage(Ea+Oa,Xa)}function Ta(){da(Qa,"["+Na+"] IFrame("+Qa+") not found")}var Wa=!1;Qa=Qa||Pa.id,Ja[Qa]&&(function(){Pa&&"contentWindow"in Pa&&null!==Pa.contentWindow?Sa():Ta()}(),function(){Ra&&Ja[Qa]&&Ja[Qa].warningTimeout&&(Ja[Qa].msgTimeout=setTimeout(function(){!Ja[Qa]||Ja[Qa].loaded||Wa||(Wa=!0,da(Qa,"IFrame has not responded within "+Ja[Qa].warningTimeout/1e3+" seconds. Check iFrameResizer.contentWindow.js has been loaded in iFrame. This message can be ingored if everything is working, or you can set the warningTimeout option to a higher value or zero to suppress this warning."))},Ja[Qa].warningTimeout))}())}function pa(Na){return Na+":"+Ja[Na].bodyMarginV1+":"+Ja[Na].sizeWidth+":"+Ja[Na].log+":"+Ja[Na].interval+":"+Ja[Na].enablePublicMethods+":"+Ja[Na].autoResize+":"+Ja[Na].bodyMargin+":"+Ja[Na].heightCalculationMethod+":"+Ja[Na].bodyBackground+":"+Ja[Na].bodyPadding+":"+Ja[Na].tolerance+":"+Ja[Na].inPageLinks+":"+Ja[Na].resizeFrom+":"+Ja[Na].widthCalculationMethod}function qa(Na,Oa){function Qa(){var bb=Oa&&Oa.id||Ma.id+za++;return null!==document.getElementById(bb)&&(bb+=za++),bb}function Ua(){var bb=Ja[ab]&&Ja[ab].firstRun,cb=Ja[ab]&&Ja[ab].heightCalculationMethod in Ia;!bb&&cb&&la({iframe:Na,height:0,width:0,type:"init"})}function Xa(bb){if("object"!=typeof bb)throw new TypeError("Options is not an object")}function Ya(bb){for(var cb in Ma)Ma.hasOwnProperty(cb)&&(Ja[ab][cb]=bb.hasOwnProperty(cb)?bb[cb]:Ma[cb])}function Za(bb){return""===bb||"file://"===bb?"*":bb}var ab=function(bb){return La=bb,""===bb&&(Na.id=bb=Qa(),Aa=(Oa||{}).log,La=bb,ba(bb,"Added missing iframe ID: "+bb+" ("+Na.src+")")),bb}(Na.id);(function(){return ab in Ja&&"iFrameResizer"in Na})()?da(ab,"Ignored iFrame, already setup."):(function(bb){bb=bb||{},Ja[ab]={firstRun:!0,iframe:Na,remoteHost:Na.src.split("/").slice(0,3).join("/")},Xa(bb),Ya(bb),Ja[ab]&&(Ja[ab].targetOrigin=!0===Ja[ab].checkOrigin?Za(Ja[ab].remoteHost):"*")}(Oa),function(){switch(ba(ab,"IFrame scrolling "+(Ja[ab]&&Ja[ab].scrolling?"enabled":"disabled")+" for "+ab),Na.style.overflow=!1===(Ja[ab]&&Ja[ab].scrolling)?"hidden":"auto",Ja[ab]&&Ja[ab].scrolling){case!0:Na.scrolling="yes";break;case!1:Na.scrolling="no";break;default:Na.scrolling=Ja[ab]?Ja[ab].scrolling:"no";}}(),function(){function bb(db){1/0!==Ja[ab][db]&&0!==Ja[ab][db]&&(Na.style[db]=Ja[ab][db]+"px",ba(ab,"Set "+db+" = "+Ja[ab][db]+"px"))}function cb(db){if(Ja[ab]["min"+db]>Ja[ab]["max"+db])throw new Error("Value for min"+db+" can not be greater than max"+db)}cb("Height"),cb("Width"),bb("maxHeight"),bb("minHeight"),bb("maxWidth"),bb("minWidth")}(),function(){("number"==typeof(Ja[ab]&&Ja[ab].bodyMargin)||"0"===(Ja[ab]&&Ja[ab].bodyMargin))&&(Ja[ab].bodyMarginV1=Ja[ab].bodyMargin,Ja[ab].bodyMargin=""+Ja[ab].bodyMargin+"px")}(),function(bb){X(Na,"load",function(){oa("iFrame.onload",bb,Na,W,!0),Ua()}),oa("init",bb,Na,W,!0)}(pa(ab)),function(){Function.prototype.bind&&Ja[ab]&&(Ja[ab].iframe.iFrameResizer={close:ha.bind(null,Ja[ab].iframe),resize:oa.bind(null,"Window resize","resize",Ja[ab].iframe),moveToAnchor:function(bb){oa("Move to anchor","moveToAnchor:"+bb,Ja[ab].iframe,ab)},sendMessage:function(bb){bb=JSON.stringify(bb),oa("Send Message","message:"+bb,Ja[ab].iframe,ab)}})}())}function ra(Na,Oa){null===Ka&&(Ka=setTimeout(function(){Ka=null,Na()},Oa))}function sa(){function Na(){function Ra(Ta){function Ua(Wa){return"0px"===(Ja[Ta]&&Ja[Ta].iframe.style[Wa])}Ja[Ta]&&function(Wa){return null!==Wa.offsetParent}(Ja[Ta].iframe)&&(Ua("height")||Ua("width"))&&oa("Visibility change","resize",Ja[Ta].iframe,Ta)}for(var Sa in Ja)Ra(Sa)}function Oa(Ra){ba("window","Mutation observed: "+Ra[0].target+" "+Ra[0].type),ra(Na,16)}var Qa=window.MutationObserver||window.WebKitMutationObserver;Qa&&function(){var Ra=document.querySelector("body"),Ta=new Qa(Oa);Ta.observe(Ra,{attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0})}()}function ta(Na){ba("window","Trigger event: "+Na),ra(function(){va("Window "+Na,"resize")},16)}function ua(){"hidden"!==document.visibilityState&&(ba("document","Trigger event: Visiblity change"),ra(function(){va("Tab Visable","resize")},16))}function va(Na,Oa){function Pa(Ra){return Ja[Ra]&&"parent"===Ja[Ra].resizeFrom&&Ja[Ra].autoResize&&!Ja[Ra].firstRun}for(var Qa in Ja)Pa(Qa)&&oa(Na,Oa,document.getElementById(Qa),Qa)}function wa(){X(window,"message",fa),X(window,"resize",function(){ta("resize")}),X(document,"visibilitychange",ua),X(document,"-webkit-visibilitychange",ua),X(window,"focusin",function(){ta("focus")}),X(window,"focus",function(){ta("focus")})}function xa(){function Na(Qa,Ra){Ra&&(function(){if(!Ra.tagName)throw new TypeError("Object is not a valid DOM element");if("IFRAME"!==Ra.tagName.toUpperCase())throw new TypeError("Expected <IFRAME> tag, found <"+Ra.tagName+">")}(),qa(Ra,Qa),Pa.push(Ra))}function Oa(Qa){Qa&&Qa.enablePublicMethods&&da("enablePublicMethods option has been removed, public methods are now always available in the iFrame")}var Pa;return Z(),wa(),function(Qa,Ra){switch(Pa=[],Oa(Qa),typeof Ra){case"undefined":case"string":Array.prototype.forEach.call(document.querySelectorAll(Ra||"iframe"),Na.bind(W,Qa));break;case"object":Na(Qa,Ra);break;default:throw new TypeError("Unexpected data type ("+typeof Ra+")");}return Pa}}function ya(Na){Na.fn?Na.fn.iFrameResize||(Na.fn.iFrameResize=function(Oa){return this.filter("iframe").each(function(Qa,Ra){qa(Ra,Oa)}).end()}):ca("","Unable to bind to jQuery, it is not fully loaded.")}if("undefined"!=typeof window){var za=0,Aa=!1,Ba=!1,Da="message".length,Ea="[iFrameSizer]",Fa=Ea.length,Ga=null,Ha=window.requestAnimationFrame,Ia={max:1,scroll:1,bodyScroll:1,documentElementScroll:1},Ja={},Ka=null,La="Host Page",Ma={autoResize:!0,bodyBackground:null,bodyMargin:null,bodyMarginV1:8,bodyPadding:null,checkOrigin:!0,inPageLinks:!1,enablePublicMethods:!0,heightCalculationMethod:"bodyOffset",id:"iFrameResizer",interval:32,log:!1,maxHeight:1/0,maxWidth:1/0,minHeight:0,minWidth:0,resizeFrom:"parent",scrolling:!1,sizeHeight:!0,sizeWidth:!1,warningTimeout:5e3,tolerance:0,widthCalculationMethod:"scroll",closedCallback:function(){},initCallback:function(){},messageCallback:function(){da("MessageCallback function not defined")},resizedCallback:function(){},scrollCallback:function(){return!0}};window.jQuery&&ya(window.jQuery),"function"==typeof define&&define.amd?define([],xa):"object"==typeof module&&"object"==typeof module.exports?module.exports=xa():window.iFrameResize=window.iFrameResize||xa()}}();let finallyCommentsSystem={init:()=>{finallyCommentsSystem.setupIframe(),iFrameResize({},".finally-comments iframe")},getPartsFromLink:W=>{let X=W.substr(W.length-1);"/"===X&&(W=W.slice(0,-1));let Y=W.split("/");return{permlink:Y.pop(),author:Y.pop(),category:Y.pop()}},setupIframe:()=>{let W=document.querySelector(".finally-comments"),X=W.dataset.id,Y;if(W.dataset.api)Y=X;else{let _=finallyCommentsSystem.getPartsFromLink(X);Y=`https://finallycomments.com/thread/${_.category}/${_.author}/${_.permlink}`}console.log("URL: ",Y);let Z=document.createElement("iframe",{scrolling:"no"});Z.src=Y,Z.width="100%",Z.style="border: none;",W.appendChild(Z),Z.classList.add("finally-frame");let $={message:"finally-frame-load",reputation:W.dataset.reputation,profile:W.dataset.profile,values:W.dataset.values,generated:W.dataset.generated};Z.onload=()=>{document.querySelector(".finally-frame").contentWindow.postMessage($,"*")}}};finallyCommentsSystem.init(),window.addEventListener("message",receiveMessage,!1);function receiveMessage(W){if("new-comment"==W.data.message){if("https://finallycomments.com"!==W.origin)return;let X=getDistanceFromTop(document.querySelector(".finally-comments")),Y=document.querySelector(".finally-comments").getBoundingClientRect().height;document.documentElement.scrollTop=void 0===W.data.depth||0===W.data.depth?X+Y:W.data.offset+X-300}}function getDistanceFromTop(W){for(var X=0;W;)X+=W.offsetTop,W=W.offsetParent;return X}
